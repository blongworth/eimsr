---
title: "AR99 underway maps"
author: "Brett Longworth"
date: "2026-01-17"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# libraries
library(tidyverse)
library(eimsr)
library(here)
library(dygraphs)
library(plotly)

theme_set(theme_classic())
```


```{r}
source(here("inst/get_AR99_data.R"))

cruise_start <- as.POSIXct("2026-01-13 17:30:00", tz = "UTC")

eims <- eims |> 
  filter(timestamp > cruise_start) |> 
  mutate(mass_3240 = mass_32 / mass_40)

optode <- filter(optode, timestamp > cruise_start)
temps <- filter(temps, timestamp > cruise_start)
underway <- filter(underway, timestamp > cruise_start)
```

# Plots!

## EIMS

40/32 over time. Check that data are continuous and no major noise or ratio issues. 

```{r}
plot_eims_air_bands(eims, "mass_3240", yaxis_title = "Mass 32/40")
```

## Optode

Air saturation over time. Ugh. 

```{r}
plot_ts(optode, "air_saturation")
```

```{r}
ggplot(optode, aes(timestamp, air_saturation)) +
  geom_line(size = 0.3)
```


## temp server

### Thermistor

```{r}
plot_ts(temps, "thermistor") 
  
```
```{r}
plot_ts(temps, "water_flow")
```
```{r}
plot_ts(temps, "pressure")
```

## Underway

```{r}
plot_ts(underway, "FLOW")
```


```{r}
ggplot(underway, aes(timestamp, FLOW)) +
  geom_line(size = .2) +
  ggtitle("Underway Seawater Flow")
```

```{r}
plot_ts(underway, "SBE48T")
```

```{r}
plot_ts(underway, "SBE45S")
```

```{r}
plot_ts(underway, "FLR")
```
